/*   MingGe.scrollLoad2.51插件（Min）
 *
 *   2.51升级内容：加入container容器操作，这个功能在2.0的时候忘记了，修复各种事件机制，以及各种优化修复等
 *  
 *   图片或者节点滚动加载插件
 *
 *   MingGe.scrollLoad采用MingGeJS开发，兼容IE6/7/8，及尘世间所有一齐浏览器
 *
 *   作者：明哥先生-QQ399195513 QQ群：461550716 官网：www.shearphoto.com
 */
!function(a,b){var c,d=MingGe,e=d.delEvent,f=d.addEvent,g=[],h=document,i={attr:"_src",loadTime:50,container:$(a),del:!0,animate:"ease",event:"scroll"},j=function(c){var f,i,j,k,l,m,n,o=this,p=d.isUndefined(c),q=h.body;for(n=0;n<o.length;n++)m=o[n],k=m==a,l=k?d:m,f=l.MingGeScrollLoad,d.isNumber(f)&&(i=g[f])&&d.each(i,function(n,o){if((p||n==c)&&(j=o.callback.count,"scroll"==n&&m==h&&m==q&&(m=a,k=!0),k&&"scroll"==n?j&&2>j?(k&&"scroll"==n&&delete i[n],e(a,"scroll",o.callback),e(a,"resize",o.callback)):j&&o.callback.count--:(e(m,n,o.callback),delete i[n])),d.isEmptyObject(i)){delete g[f],d.isEmptyObject(g)&&(g=[]);try{delete l.MingGeScrollLoad}catch(r){l.MingGeScrollLoad=b}}})},k=function(a,b){for(var c=a.length-1;c>-1;c--)a[c].getAttribute(b.attr)?a[c].setAttribute("src",b.defaultSrc):a.splice(c,1)},l=function(a){return function(){a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){a.run(),a.timer=null},a.arg.loadTime)}},m=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},n=function(a,b){return function(){a.animate({opacity:1},500,b.arg.animate,function(){d(this).css("opacity",null),b.arg.success&&b.arg.success.call(this)}),b.callback()}},o=function(a,b){a.attr=d.isString(a.attr)?d.trim(a.attr):null,a.loadTime=d.isNumber(a.loadTime=parseFloat(a.loadTime))&&0!==a.loadTime?a.loadTime:50,d.isFunction(a.success)||(a.success=!1),d.isFunction(a.error)||(a.error=!1),d.isString(a.defaultSrc)&&a.attr&&k(b,a)},p=function(a,b){null==c&&(c=!!(d._protected.transition=d.html5Attribute("transition"))),d.isObject(b)||(b={}),d.isString(b.event)||(b.event=i.event),b.container||(b.container=i.container),this.callback=l(this),this.callback.count=0,this.writeEvent(this.callback,a,b)};p.prototype={handle:function(b,c,e,h,j,k){var l,n,p=h.MingGeScrollLoad,q=d.isNumber(p)&&(l=g[p]);if(!k&&q&&(l=l[e.event]))o.call(l,l.arg=d.extend(l.arg,e),c),l.img=c,j&&l.callback();else if(n=this.callback,k||(q?q[e.event]=this:g[h.MingGeScrollLoad=g.push({})-1][e.event]=this),this.arg||(o.call(this,this.arg=d.extend(m(i),e),c),this.img=c),b==a&&j?(f(a,"scroll",n),f(a,"resize",n)):f(b,e.event,n),j)return!0},writeEvent:function(b,c,e){var f,g,i,j=0,k=0,l=h.body,m="scroll"==e.event;if(e.container&&e.container.version){for(;f=e.container.nodeList[j++];)!m||f!=a&&f!=h&&f!=l?(g=f==a?d:f,this.handle(f,c,e,g,m)===!0&&(k++,i=!0)):k||(k=1);(b.count=k)&&(this.handle(a,c,e,d,m,i),this.arg&&b())}},setSrc:function(a,b,g){var h,i,j,k,l,m=a[b],o=!1,p=this.arg;m&&(o=this.isRange(g,m),o&&(a.splice(b,1),j=this,o!==!0&&(i=new Image,k=function(){e(i,"load",l),e(i,"error",k),p.error&&p.error.call(m)},l=function(){e(i,"load",l),e(i,"error",k),c&&p.animate?(h=d(m).css("opacity",0),m.src=o,setTimeout(n(h,j),10)):(m.src=o,setTimeout(function(){j.callback()},10),p.success&&p.success.call(m)),m.removeAttribute(p.attr)},f(i,"load",l),f(i,"error",k),i.src=o),i||p.success&&p.success.call(m))),o===!1&&a.splice(b,1)},isRange:function(a,b){var c,d,e,f,g,h,i,j,k,l=this.arg.attr?b.getAttribute(this.arg.attr):!0;return l?(c=b.getBoundingClientRect(),d=a[0],e=d+a[2],f=a[1],g=f+a[3],h=c.left+d+1,i=h+b.offsetWidth,j=c.top+f+1,k=j+b.offsetHeight,(j>f&&g>j||k>f&&g>k)&&(h>d&&e>h||i>d&&e>i)?l:void 0):!1},Calculation:function(){var a=this.img,b=a.length-1;if(0>b)this.arg.del&&j.call(this.arg.container.nodeList,this.arg.event);else for(;b>-1;b--)this.setSrc(a,b,arguments)},run:function(){var a=d(h);this.Calculation(a.scrollLeft(),a.scrollTop(),a.clientWidth(),a.clientHeight())}},d.fn.extend({delScrollLoad:function(a){return j.call(this.nodeList,a),this},scrollLoad:function(a){return new p(this.nodeList,a),this}})}(window);