/*   MingGe.scrollLoad2.52插件（Min）
 *
 *   2.52升级内容：加入bubblScrollLoad手动冒泡事件，container容器操作，这个功能在2.0的时候忘记了，修复各种事件机制，以及各种优化修复等
 *  
 *   图片或者节点滚动加载插件
 *
 *   MingGe.scrollLoad采用MingGeJS开发，兼容IE6/7/8，及尘世间所有一齐浏览器
 *
 *   作者：明哥先生-QQ399195513 QQ群：461550716 官网：www.shearphoto.com
 */
!function(a,b){var c,d,e=MingGe,f=e.delEvent,g=e.addEvent,h=[],i=document,j={attr:"_src",loadTime:50,container:$(a),del:!0,animate:["ease",500],event:"scroll"},k=function(c){var d,g,j,k,l,m,n,o=this,p=e.isUndefined(c=e.trim(c)),q=i.body;for(n=0;n<o.length;n++)m=o[n],k=m==a||"scroll"==c&&(m==i||m==q),l=k?e:m,d=l.MingGeScrollLoad,e.isNumber(d)&&(g=h[d])&&e.each(g,function(i,n){if((p||i==c)&&(j=n.callback.count,k&&"scroll"==i?j&&2>j?(k&&"scroll"==i&&delete g[i],f(a,"scroll",n.callback),f(a,"resize",n.callback)):j&&n.callback.count--:(f(m,i,n.callback),delete g[i])),e.isEmptyObject(g)){delete h[d],e.isEmptyObject(h)&&(h=[]);try{delete l.MingGeScrollLoad}catch(o){l.MingGeScrollLoad=b}}})},l=function(a,b){for(var c=a.length-1;c>-1;c--)a[c].getAttribute(b.attr)?a[c].src=b.defaultSrc:a.splice(c,1)},m=function(a){return function(){a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){a.run(),a.timer=null},a.arg.loadTime)}},n=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},o=function(a,b){return function(){var c=b.arg,e=c.animate;a.animate({opacity:1},e[1],e[0],function(){this.style[d]=null,c.success&&c.success.call(this)}),b.callback()}},p=function(a,b){a.attr=e.isString(a.attr)?e.trim(a.attr):null,a.loadTime=e.isNumber(a.loadTime=parseFloat(a.loadTime))&&0!==a.loadTime?a.loadTime:50,e.isFunction(a.success)||(a.success=!1),e.isFunction(a.error)||(a.error=!1),e.isString(a.defaultSrc)&&a.attr&&l(b,a),a.animate===!1||e.isArray(a.animate)||(a.animate=["ease",500])},q=function(a,b){null==c&&(d=e.html5Attribute("opacity"),c=!!(e._protected.transition=e.html5Attribute("transition"))),e.isObject(b)||(b={}),e.isString(b.event)||(b.event=j.event),b.container||(b.container=j.container),this.callback=m(this),this.callback.count=0,this.writeEvent(this.callback,a,b)};q.prototype={handle:function(b,c,d,f,i,k){var l,m,o=f.MingGeScrollLoad,q=e.isNumber(o)&&(l=h[o]);if(!k&&q&&(l=l[d.event]))p.call(l,l.arg=e.extend(l.arg,d),c),l.img=c,i&&l.callback();else if(m=this.callback,k||(q?q[d.event]=this:h[f.MingGeScrollLoad=h.push({})-1][d.event]=this),this.arg||(p.call(this,this.arg=e.extend(n(j),d),c),this.img=c),b==a&&i?(g(a,"scroll",m),g(a,"resize",m)):g(b,d.event,m),i)return!0},writeEvent:function(b,c,d){var f,g,h,j=0,k=0,l=i.body,m="scroll"==d.event;if(d.container&&d.container.version){for(;f=d.container.nodeList[j++];)!m||f!=a&&f!=i&&f!=l?(g=f==a?e:f,this.handle(f,c,d,g,m)===!0&&(k++,h=!0)):k||(k=1);(b.count=k)&&(this.handle(a,c,d,e,m,h),this.arg&&b())}},setSrc:function(a,b,h){var i,j,k,l,m=a[b],n=!1,p=this.arg;m&&(n=this.isRange(h,m),n&&(a.splice(b,1),j=this,n!==!0&&(i=new Image,k=function(){f(i,"load",l),f(i,"error",k),p.error&&p.error.call(m)},l=function(){f(i,"load",l),f(i,"error",k),c&&p.animate?(m.style[d]=0,setTimeout(o(e(m),j),10)):(setTimeout(function(){j.callback()},10),p.success&&p.success.call(m)),m.src=n,m.removeAttribute(p.attr)},g(i,"load",l),g(i,"error",k),i.src=n),i||p.success&&p.success.call(m))),n===!1&&a.splice(b,1)},isRange:function(a,b){var c,d,e,f,g,h,i,j,k,l=this.arg.attr?b.getAttribute(this.arg.attr):!0;return l?(c=b.getBoundingClientRect(),d=a[0],e=d+a[2],f=a[1],g=f+a[3],h=c.left+d+1,i=h+b.offsetWidth,j=c.top+f+1,k=j+b.offsetHeight,(j>f&&g>j||k>f&&g>k)&&(h>d&&e>h||i>d&&e>i)?l:void 0):!1},Calculation:function(){var a=this.img,b=a.length-1;if(0>b)this.arg.del&&k.call(this.arg.container.nodeList,this.arg.event);else for(;b>-1;b--)this.setSrc(a,b,arguments)},run:function(){var a=e(i);this.Calculation(a.scrollLeft(),a.scrollTop(),a.clientWidth(),a.clientHeight())}},e.fn.extend({delScrollLoad:function(a){return k.call(this.nodeList,a),this},bubblScrollLoad:function(b){var c,d,f,g=0;for(b=e.isString(b)&&e.trim(b)||"scroll";c=this.nodeList[g++];)f=c==a||"scroll"==b&&(c==i||c==i.body)?e:c,d=f.MingGeScrollLoad,e.isNumber(d)&&(f=h[d])&&(f=h[d][b])&&f.callback();return this},scrollLoad:function(a){return new q(this.nodeList.concat(),a),this}})}(window);